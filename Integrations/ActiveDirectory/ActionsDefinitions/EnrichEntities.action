{
    "CreationTimeUnixTimeInMs": 1512662335217, 
    "Creator": "admin", 
    "Description": "Enrich Hostname or Username entities with Active Directory properties",
    "DynamicResultsMetadata": [
        {
            "ResultExample": "\"[{\\\"Entity\\\": \\\"test\\\", \\\"EntityResult\\\": {\\\"accountExpires\\\": [\\\"9999-12-31 23:59:59.999999+00:00\\\"], \\\"adminCount\\\": [1], \\\"badPasswordTime\\\": [\\\"2021-03-02 15:33:46.599745+00:00\\\"], \\\"badPwdCount\\\": [0], \\\"cn\\\": [\\\"test\\\"], \\\"codePage\\\": [0], \\\"countryCode\\\": [0], \\\"dSCorePropagationData\\\": [\\\"2021-05-06 22:11:27+00:00\\\", \\\"1601-01-01 00:00:00+00:00\\\"], \\\"displayName\\\": [\\\"test\\\"], \\\"distinguishedName\\\": [\\\"CN=test,CN=Users,DC=xxxxb2019,DC=local\\\"], \\\"garbageCollPeriod\\\": [1209600], \\\"givenName\\\": [\\\"test\\\"], \\\"homeMDB\\\": [\\\"CN=Mailbox Database 0058301203,CN=Databases,CN=Exchange Administrative Group (FYDIBOHF23SPDLT),CN=Administrative Groups,CN=mwc,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=xxxxb2019,DC=local\\\"], \\\"instanceType\\\": [4], \\\"internetEncoding\\\": [0], \\\"lastLogoff\\\": [\\\"1601-01-01 00:00:00+00:00\\\"], \\\"lastLogon\\\": [\\\"2021-03-08 21:49:57.418140+00:00\\\"], \\\"lastLogonTimestamp\\\": [\\\"2021-03-02 15:33:50.881191+00:00\\\"], \\\"legacyExchangeDN\\\": [\\\"/o=mwc/ou=Exchange Administrative Group (FYDIBOHF23SPDLT)/cn=Recipients/cn=d01b6cf255d54dd3923474833475df49-test\\\"], \\\"logonCount\\\": [3], \\\"mDBUseDefaults\\\": [true], \\\"mail\\\": [\\\"test@xxxxb2019.local\\\"], \\\"mailNickname\\\": [\\\"test\\\"], \\\"memberOf\\\": [\\\"CN=ADDGroups,CN=Users,DC=xxxxb2019,DC=local\\\", \\\"CN=US Staff,CN=Users,DC=xxxxb2019,DC=local\\\", \\\"CN=Domain Admins,CN=Users,DC=xxxxb2019,DC=local\\\"], \\\"msDS-UserPasswordExpiryTimeComputed\\\": [132627588006240398], \\\"msExchAddressBookFlags\\\": [1], \\\"msExchArchiveQuota\\\": [104857600], \\\"msExchArchiveWarnQuota\\\": [94371840], \\\"msExchBypassAudit\\\": [false], \\\"msExchCalendarLoggingQuota\\\": [6291456], \\\"msExchDelegateListLink\\\": [\\\"CN=Administrator,CN=Users,DC=xxxxb2019,DC=local\\\"], \\\"msExchDumpsterQuota\\\": [31457280], \\\"msExchDumpsterWarningQuota\\\": [20971520], \\\"msExchELCMailboxFlags\\\": [130], \\\"msExchGroupSecurityFlags\\\": [0], \\\"msExchHomeServerName\\\": [\\\"/o=mwc/ou=Exchange Administrative Group (FYDIBOHF23SPDLT)/cn=Configuration/cn=Servers/cn=xxxxB2019-EX\\\"], \\\"msExchMDBRulesQuota\\\": [256], \\\"msExchMailboxAuditEnable\\\": [false], \\\"msExchMailboxAuditLogAgeLimit\\\": [7776000], \\\"msExchMailboxFolderSet\\\": [0], \\\"msExchMailboxGuid\\\": [{\\\"encoded\\\": \\\"123456==\\\", \\\"encoding\\\": \\\"base64\\\"}], \\\"msExchMailboxSecurityDescriptor\\\": [{\\\"encoded\\\": \\\"123456==\\\", \\\"encoding\\\": \\\"base64\\\"}], \\\"msExchModerationFlags\\\": [6], \\\"msExchPoliciesIncluded\\\": [\\\"123-123-123-123-123\\\", \\\"{123-123-123-123-123}\\\"], \\\"msExchProvisioningFlags\\\": [0], \\\"msExchRBACPolicyLink\\\": [\\\"CN=Default Role Assignment Policy,CN=Policies,CN=RBAC,CN=mwc,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=xxxxb2019,DC=local\\\"], \\\"msExchRecipientDisplayType\\\": [1073741824], \\\"msExchRecipientSoftDeletedStatus\\\": [0], \\\"msExchRecipientTypeDetails\\\": [1], \\\"msExchTextMessagingState\\\": [302120705, 16842751], \\\"msExchTransportRecipientSettingsFlags\\\": [0], \\\"msExchUMDtmfMap\\\": [\\\"emailAddress:837887372\\\", \\\"lastNameFirstName:873728378\\\", \\\"firstNameLastName:837887372\\\"], \\\"msExchUMEnabledFlags2\\\": [-1], \\\"msExchUserAccountControl\\\": [0], \\\"msExchUserCulture\\\": [\\\"en-US\\\"], \\\"msExchVersion\\\": [88218628259840], \\\"msExchWhenMailboxCreated\\\": [\\\"2021-03-02 03:40:00+00:00\\\"], \\\"name\\\": [\\\"test\\\"], \\\"objectCategory\\\": [\\\"CN=Person,CN=Schema,CN=Configuration,DC=xxxxb2019,DC=local\\\"], \\\"objectClass\\\": [\\\"top\\\", \\\"person\\\", \\\"organizationalPerson\\\", \\\"user\\\"], \\\"objectGUID\\\": [\\\"{123-123-123-123-123}\\\"], \\\"objectSid\\\": [\\\"S-1-5-21-123-123-123-123\\\"], \\\"primaryGroupID\\\": [513], \\\"protocolSettings\\\": [\\\"RemotePowerShell\\\\u00a71\\\"], \\\"proxyAddresses\\\": [\\\"SMTP:test@xxxxb2019.local\\\"], \\\"pwdLastSet\\\": [\\\"2021-03-02 03:40:00.624041+00:00\\\"], \\\"sAMAccountName\\\": [\\\"test\\\"], \\\"sAMAccountType\\\": [805306368], \\\"showInAddressBook\\\": [\\\"CN=Mailboxes(VLV),CN=All System Address Lists,CN=Address Lists Container,CN=mwc,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=xxxxb2019,DC=local\\\", \\\"CN=All Mailboxes(VLV),CN=All System Address Lists,CN=Address Lists Container,CN=mwc,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=xxxxb2019,DC=local\\\", \\\"CN=All Recipients(VLV),CN=All System Address Lists,CN=Address Lists Container,CN=mwc,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=xxxxb2019,DC=local\\\", \\\"CN=Default Global Address List,CN=All Global Address Lists,CN=Address Lists Container,CN=mwc,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=xxxxb2019,DC=local\\\", \\\"CN=All Users,CN=All Address Lists,CN=Address Lists Container,CN=mwc,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=xxxxb2019,DC=local\\\"], \\\"sn\\\": [\\\"user2\\\"], \\\"uSNChanged\\\": [102817], \\\"uSNCreated\\\": [28739], \\\"userAccountControl\\\": [512], \\\"userPrincipalName\\\": [\\\"test@xxxxb2019.local\\\"], \\\"whenChanged\\\": [\\\"2021-05-06 22:11:27+00:00\\\"], \\\"whenCreated\\\": [\\\"2021-03-02 03:40:00+00:00\\\"]}}, {\\\"Entity\\\": \\\"xxxxB2019-EX\\\", \\\"EntityResult\\\": {\\\"accountExpires\\\": [\\\"9999-12-31 23:59:59.999999+00:00\\\"], \\\"badPasswordTime\\\": [\\\"1601-01-01 00:00:00+00:00\\\"], \\\"badPwdCount\\\": [0], \\\"cn\\\": [\\\"xxxxB2019-EX\\\"], \\\"codePage\\\": [0], \\\"countryCode\\\": [0], \\\"dNSHostName\\\": [\\\"xxxxB2019-EX.xxxxb2019.local\\\"], \\\"dSCorePropagationData\\\": [\\\"2021-03-01 22:14:54+00:00\\\", \\\"2021-03-01 22:14:54+00:00\\\", \\\"2021-03-01 22:13:05+00:00\\\", \\\"2021-03-01 22:13:04+00:00\\\", \\\"1601-07-14 22:36:49+00:00\\\"], \\\"distinguishedName\\\": [\\\"CN=xxxxB2019-EX,CN=Computers,DC=xxxxb2019,DC=local\\\"], \\\"instanceType\\\": [4], \\\"isCriticalSystemObject\\\": [false], \\\"lastLogoff\\\": [\\\"1601-01-01 00:00:00+00:00\\\"], \\\"lastLogon\\\": [\\\"2021-05-27 16:45:33.537247+00:00\\\"], \\\"lastLogonTimestamp\\\": [\\\"2021-05-21 02:00:28.131941+00:00\\\"], \\\"localPolicyFlags\\\": [0], \\\"logonCount\\\": [884], \\\"mail\\\": [], \\\"memberOf\\\": [\\\"CN=Exchange Install Domain Servers,CN=Microsoft Exchange System Objects,DC=xxxxb2019,DC=local\\\", \\\"CN=Managed Availability Servers,OU=Microsoft Exchange Security Groups,DC=xxxxb2019,DC=local\\\", \\\"CN=Exchange Trusted Subsystem,OU=Microsoft Exchange Security Groups,DC=xxxxb2019,DC=local\\\", \\\"CN=Exchange Servers,OU=Microsoft Exchange Security Groups,DC=xxxxb2019,DC=local\\\"], \\\"msDS-SupportedEncryptionTypes\\\": [28], \\\"msDS-UserPasswordExpiryTimeComputed\\\": [9223372036854775807], \\\"msExchCapabilityIdentifiers\\\": [1], \\\"msExchRMSComputerAccountsBL\\\": [\\\"CN=FederatedEmail.123-123-123-123-123,CN=Users,DC=xxxxb2019,DC=local\\\"], \\\"name\\\": [\\\"xxxxB2019-EX\\\"], \\\"objectCategory\\\": [\\\"CN=Computer,CN=Schema,CN=Configuration,DC=xxxxb2019,DC=local\\\"], \\\"objectClass\\\": [\\\"top\\\", \\\"person\\\", \\\"organizationalPerson\\\", \\\"user\\\", \\\"computer\\\"], \\\"objectGUID\\\": [\\\"{123-123-123-123-123}\\\"], \\\"objectSid\\\": [\\\"S-1-5-21-123-123-123-123\\\"], \\\"operatingSystem\\\": [\\\"Windows Server 2019 Standard Evaluation\\\"], \\\"operatingSystemVersion\\\": [\\\"10.0 (17763)\\\"], \\\"primaryGroupID\\\": [515], \\\"pwdLastSet\\\": [\\\"2021-05-01 14:28:29.910906+00:00\\\"], \\\"sAMAccountName\\\": [\\\"xxxxB2019-EX$\\\"], \\\"sAMAccountType\\\": [805306369], \\\"servicePrincipalName\\\": [\\\"IMAP/xxxxB2019-EX\\\", \\\"IMAP/xxxxB2019-EX.xxxxb2019.local\\\", \\\"IMAP4/xxxxB2019-EX\\\", \\\"IMAP4/xxxxB2019-EX.xxxxb2019.local\\\", \\\"POP/xxxxB2019-EX\\\", \\\"POP/xxxxB2019-EX.xxxxb2019.local\\\", \\\"POP3/xxxxB2019-EX\\\", \\\"POP3/xxxxB2019-EX.xxxxb2019.local\\\", \\\"exchangeRFR/xxxxB2019-EX\\\", \\\"exchangeRFR/xxxxB2019-EX.xxxxb2019.local\\\", \\\"exchangeAB/xxxxB2019-EX\\\", \\\"exchangeAB/xxxxB2019-EX.xxxxb2019.local\\\", \\\"exchangeMDB/xxxxB2019-EX\\\", \\\"exchangeMDB/xxxxB2019-EX.xxxxb2019.local\\\", \\\"SMTP/xxxxB2019-EX\\\", \\\"SMTP/xxxxB2019-EX.xxxxb2019.local\\\", \\\"SmtpSvc/xxxxB2019-EX\\\", \\\"SmtpSvc/xxxxB2019-EX.xxxxb2019.local\\\", \\\"TERMSRV/xxxxB2019-EX\\\", \\\"TERMSRV/xxxxB2019-EX.xxxxb2019.local\\\", \\\"WSMAN/xxxxB2019-EX\\\", \\\"WSMAN/xxxxB2019-EX.xxxxb2019.local\\\", \\\"RestrictedKrbHost/xxxxB2019-EX\\\", \\\"HOST/xxxxB2019-EX\\\", \\\"RestrictedKrbHost/xxxxB2019-EX.xxxxb2019.local\\\", \\\"HOST/xxxxB2019-EX.xxxxb2019.local\\\"], \\\"uSNChanged\\\": [119324], \\\"uSNCreated\\\": [12744], \\\"userAccountControl\\\": [4096], \\\"whenChanged\\\": [\\\"2021-05-21 02:00:28+00:00\\\"], \\\"whenCreated\\\": [\\\"2021-03-01 18:23:27+00:00\\\"]}}]\"",
            "ResultName": "JsonResult"
        }
    ], 
    "Id": -1, 
    "IntegrationIdentifier": "ActiveDirectory", 
    "IsCustom": false, 
    "IsEnabled": true, 
    "ModificationTimeUnixTimeInMs": 1512662335217, 
    "Name": "Enrich entities", 
    "Parameters": [
        {
            "CreationTimeUnixTimeInMs": 1527419044459,
            "CustomActionId": -1,
            "DefaultValue": false,
            "Description": "Specify whether successfully enriched entities should be automatically marked as “Internal Entity”",
            "Id": -1,
            "IsMandatory": false,
            "ModificationTimeUnixTimeInMs": 1527419044459,
            "Name": "Mark entities as internal",
            "Type": 1,
            "Value": ""
        },
        {
            "CreationTimeUnixTimeInMs": 1527419044459,
            "CustomActionId": -1,
            "DefaultValue": "",
            "Description": "Provide a comma separated list of attribute names to enrich the entities with. If nothing is provided - action will enrich with all available attributes. If an attribute contains a few values - it will be enriched with all of the available values. Parameter is case sensitive.",
            "Id": -1,
            "IsMandatory": false,
            "ModificationTimeUnixTimeInMs": 1527419044459,
            "Name": "Specific Attribute Names To Enrich With",
            "Type": 0,
            "Value": ""
        },
        {
            "CreationTimeUnixTimeInMs": 1527419044459,
            "CustomActionId": -1,
            "DefaultValue": false,
            "Description": "If checked, the Case Wall Table for this action will only present the specified attributes, found in the “Specific Attribute Names To Enrich With” parameter.",
            "Id": -1,
            "IsMandatory": false,
            "ModificationTimeUnixTimeInMs": 1527419044459,
            "Name": "Should Case Wall Table be filtered by the specified Attributes?",
            "Type": 1,
            "Value": false
        },
        {
            "CreationTimeUnixTimeInMs": 1527419044459,
            "CustomActionId": -1,
            "DefaultValue": false,
            "Description": "If checked, the JSON result for this action will only return the specified attributes, found in the “Specific Attribute Names To Enrich With” parameter.",
            "Id": -1,
            "IsMandatory": false,
            "ModificationTimeUnixTimeInMs": 1527419044459,
            "Name": "Should JSON result be filtered by the specified Attributes?",
            "Type": 1,
            "Value": false
        }

    ],
    "Script": "from SiemplifyAction import *\nfrom ActiveDirectoryManager import *\t\t\n\t\t\ndef main():\n\t#List groups a user account is a member of\n\tsiemplify = SiemplifyAction()\n\tconf = siemplify.get_configuration('ActiveDirectory')\n\tserver = conf['Server']\n\tusername = conf['Username']\n\tpassword = conf['Password']\n\tdomain = conf['Domain']\n\n\tenrichedEntities = []\n\tad = ActiveDirectoryManager(server,domain,username,password)\n\t\n\tfor entity in siemplify.target_entities:\n\t\tif entity.entity_type == 'USERUNIQNAME':\n\t\t\tres = ad.enrich_user(entity.identifier)\n\t\telif entity.entity_type == 'HOSTNAME':\n\t\t\tres = ad.enrich_host(entity.identifier)\n\t\telse:\n\t\t\tcontinue\n\t\tprint entity.identifier, res\n\t\tif res:\n\t\t\tfor item in res.keys():\n\t\t\t\tline = []\n\t\t\t\tfor val in res[item]:\n\t\t\t\t\tline.append(str(val))\n\t\t\t\tentity.additional_properties['AD_' + item] = ';'.join(line)\n\t\t\tenrichedEntities.append(entity)\n\n\tif len(enrichedEntities) > 0:\n\t\tentNamesList = []\n\t\tfor ent in enrichedEntities:\n\t\t\tentNamesList.append(ent.identifier)\n\t\toutput_message = 'Following entities were enriched:\\n' + '\\n'.join(entNamesList)\n\t\tsiemplify.update_entities(enrichedEntities)\n\telse:\n\t\toutput_message = 'No entities were enriched'\n\t\n\tsiemplify.end(output_message, 'true')\n\t\n\t\nif __name__ == \"__main__\":\n\tmain()\n", 
    "ScriptResultName": "is_success", 
    "SimulationDataJson": "{\"Entities\": [\"HOSTNAME\", \"USERUNIQNAME\"]}", 
    "Type": 0, 
    "Version": 2.0,
    "IsAsync": true
}