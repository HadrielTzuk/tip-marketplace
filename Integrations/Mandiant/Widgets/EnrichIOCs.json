{
  "type": 3,
  "actionIdentifier": "Enrich IOCs",
  "title": "Mandiant - Enrich IOCs",
  "description": "This widget highlights the most important items in Mandiant - Enrich IOCs",
  "dataDefinition":
  {
    "htmlContent": "<!DOCTYPE html><html lang=\"en\"><head> <meta charset=\"UTF-8\"> <link href=\"https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700,700i\" rel=\"stylesheet\"> <script src=\"https://code.jquery.com/jquery-3.5.1.min.js\"></script> <style> body { float: left; width: 100%; padding: 0; margin: 0; box-sizing: border-box; background-color: #212C45; } ::-webkit-scrollbar { width: 0; } .cardContainer { display: flex; } .cntLeftSide { flex-direction: column; width: 30%; padding-right: 6px; height: fit-content; } .cntRightSide { width: 65%; padding-left: 3%; border-left: 1px solid #576B95; } .leftMenu { height: 38px; line-height: 38px; display: block; padding-left: 10px; cursor: pointer; overflow: hidden; text-overflow: ellipsis; color: #C3D2E8 } .leftMenu.active { background: #3A4A6C; font-weight: bold; color: #fff; } .fieldTitle { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #576B95; margin-bottom: 4px; } .fieldEntityTitle { font-weight: bold; font-size: 20px; overflow: hidden; text-overflow: ellipsis; max-width: 70%; } .field { display: flex; justify-content: space-between; padding-top: 10px; } .fieldName { width: 35%; color: #C3D2E8; padding-right: 10px; } .fieldEntityHidden { font-style: normal; font-weight: bold; width: 65%; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; cursor: pointer; } .fieldEntityOpen { overflow: hidden; overflow-y: auto; max-height: 148px; width: 65%; white-space: unset; text-overflow: unset; } svg { width: 38px; margin: 8px; } .hidden { display: none; } .fieldVulnerability { color: #C3D2E8; display: flex; flex-direction: column; padding-bottom: 12px; } .fieldNameVulnerability { color:#fff; padding-top: 10px; font-weight: bold; padding-bottom: 8px; } </style></head><body><div class=\"cardContainer\" style=\"font-family: Open Sans, serif; font-size: 12px; color: #fff\"> <div class=\"cntLeftSide\" id=\"leftMenu\"> </div> <div class=\"cntRightSide\" id=\"rightMenu\"> <div class=\"fields hidden\" id=\"threat-actor\"> <div class=\"fieldTitle\"> <div class=\"fieldEntityTitle\" id=\"threat-actor-title\"></div> <svg id=\"a\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 25 25\" fill=\"currentColor\"> <path fill=\"#FFFFF\" d=\"M19.6,13.11v8.85h3.37V9.61c-.91,0-1.75,.38-2.39,1.01-.64,.66-.98,1.54-.98,2.48Zm1.78-5.67c.47-.24,1.01-.31,1.55-.24h.03l.03-4.2h-3.33l-7.5,10.71L4.69,3H2V22h3.43V9.54l5.72,8.19h2.02l5.22-7.45c.34-.49,.74-.94,1.14-1.36l.03-.03c.5-.56,1.14-1.12,1.82-1.43Z\"/> </svg> </div> <div class=\"field\"> <div class=\"fieldName\">Aliases</div> <div class=\"fieldEntityHidden\" id=\"threat-actor-aliases\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Description</div> <div class=\"fieldEntityHidden\" id=\"threat-actor-description\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Related Audiences</div> <div class=\"fieldEntityHidden\" id=\"threat-actor-audiences\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Related Industries</div> <div class=\"fieldEntityHidden\" id=\"threat-actor-industries\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Motivations</div> <div class=\"fieldEntityHidden\" id=\"threat-actor-motivations\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Source Locations</div> <div class=\"fieldEntityHidden\" id=\"threat-actor-source-location\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Target Locations</div> <div class=\"fieldEntityHidden\" id=\"threat-actor-target-location\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Last Activity Time</div> <div class=\"fieldEntityHidden\" id=\"threat-actor-last-time\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Link</div> <a href target=\"_blank\" class=\"fieldEntityHidden\" id=\"threat-actor-link\" style=\"color: #669DF6; text-decoration-line: underline;\"></a> </div> </div> <div class=\"fields hidden\" id=\"vulnerability\"> <div class=\"fieldTitle\"> <div class=\"fieldEntityTitle\" id=\"vulnerability-title\"></div> <svg id=\"a\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 25 25\" fill=\"currentColor\"> <path d=\"M19.6,13.11v8.85h3.37V9.61c-.91,0-1.75,.38-2.39,1.01-.64,.66-.98,1.54-.98,2.48Zm1.78-5.67c.47-.24,1.01-.31,1.55-.24h.03l.03-4.2h-3.33l-7.5,10.71L4.69,3H2V22h3.43V9.54l5.72,8.19h2.02l5.22-7.45c.34-.49,.74-.94,1.14-1.36l.03-.03c.5-.56,1.14-1.12,1.82-1.43Z\"/> </svg> </div> <div class=\"fieldVulnerability\"> <div class=\"fieldNameVulnerability\">Description</div> <div class=\"fieldEntityHiddenVulnerability\" id=\"vulnerability-description\"></div> </div> <div class=\"fieldVulnerability\"> <div class=\"fieldNameVulnerability\">Executive Summary</div> <div class=\"fieldEntityHiddenVulnerability\" id=\"vulnerability-executive-summary\"></div> </div> <div class=\"fieldVulnerability\"> <div class=\"fieldNameVulnerability\">Analysis</div> <div class=\"fieldEntityHiddenVulnerability\" id=\"vulnerability-analysis\"></div> </div> <div class=\"fieldVulnerability\"> <div class=\"fieldNameVulnerability\">Fix References</div> <div id=\"vulnerability-fix-references\" style=\"display: flex; flex-direction: column; white-space: unset\"></div> </div> <div class=\"field\" style=\"font-weight: 700; margin-top: 10px; padding-top: 14px; border-top: 1px solid #576B95;\"> <div class=\"fieldName\" style=\" width: 100%; color: #fff\">Additional Information</div> </div> <div class=\"field\"> <div class=\"fieldName\">Risk rating</div> <div class=\"fieldEntityHidden\" id=\"vulnerability-risk-rating\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Exploitation State</div> <div class=\"fieldEntityHidden\" id=\"vulnerability-exploitation-state\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Date Of Disclosure</div> <div class=\"fieldEntityHidden\" id=\"vulnerability-date-disclosure\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Exploitation Vectors</div> <div class=\"fieldEntityHidden\" id=\"vulnerability-exploitation-vectors\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Exploitation Consequence</div> <div class=\"fieldEntityHidden\" id=\"vulnerability-exploitation-consequence\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Link</div> <a target=\"_blank\" class=\"fieldEntityHidden\" id=\"vulnerability-exploitation-link\" style=\"color: #669DF6; text-decoration-line: underline;\"></a> </div> </div> <div class=\"fields hidden\" id=\"indicators\"> <div class=\"fieldTitle\"> <div class=\"fieldEntityTitle\" id=\"indicators-title\"></div> <svg id=\"a\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 25 25\" fill=\"currentColor\"> <path d=\"M19.6,13.11v8.85h3.37V9.61c-.91,0-1.75,.38-2.39,1.01-.64,.66-.98,1.54-.98,2.48Zm1.78-5.67c.47-.24,1.01-.31,1.55-.24h.03l.03-4.2h-3.33l-7.5,10.71L4.69,3H2V22h3.43V9.54l5.72,8.19h2.02l5.22-7.45c.34-.49,.74-.94,1.14-1.36l.03-.03c.5-.56,1.14-1.12,1.82-1.43Z\"/> </svg> </div> <div class=\"field\"> <div class=\"fieldName\">Score</div> <div class=\"fieldEntityHidden\" id=\"indicators-score\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Related Malware Associations</div> <div class=\"fieldEntityHidden\" id=\"indicators-malware-associations\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Related Threat Actor Associations</div> <div class=\"fieldEntityHidden\" id=\"indicators-actor-associations\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">First Seen</div> <div class=\"fieldEntityHidden\" id=\"indicators-first-seen\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Last Seen</div> <div class=\"fieldEntityHidden\" id=\"indicators-last-seen\"></div> </div> <div class=\"field\"> <div class=\"fieldName\">Link</div> <a href target=\"_blank\" class=\"fieldEntityHidden\" id=\"indicators-link\" style=\"color: #669DF6; text-decoration-line: underline;\"></a> </div> </div> </div></div><script> $(document).ready(function () { const actionData = [{stepInstanceName}.JsonResult]; const availableType = ['ipv4', 'ipv6', 'hash', 'md5', 'sha1', 'sha256', 'url', 'fqdn', 'vulnerability', 'threat-actor']; const indicatorsType = ['ipv4', 'ipv6', 'hash', 'md5', 'sha1', 'sha256', 'url', 'fqdn']; if (actionData.length) { function removeSpecialSymbols(el) { return el.replaceAll(/[\\s ;:.,/%!&?-]/g, '').replaceAll('\\\\', '',) } function cutTag(el) { return el.replaceAll('<p>', '').replaceAll('</p>', '',) } function entityDisplayed(el) { let type; let elId; let actionObj; if (Array.isArray(el.EntityResult)) { type = el.EntityResult[0].type; elId = el.Entity; actionObj = el.EntityResult[0]; } else { type = el.EntityResult.type; elId = el.Entity; actionObj = el.EntityResult; } function checkThreatActorField(field) { if (field === undefined) { return \"n/a\"; } else { let arrayEntity = field.map((el) => el.name); return arrayEntity.length > 0 ? arrayEntity.join(', ') : \"n/a\"; } } function checkField(field) { if (field === undefined) { return \"n/a\"; } else if (typeof field === \"number\") { return field } else { return field.length > 0 ? field : \"n/a\"; } } function checkLink(link, id) { return link ? id.html(link).attr('href', link) : id.html('n/a'); } if (type === \"threat-actor\") { let threatActorAliases = actionObj.aliases; let arrayAudiences = actionObj.audience; let arrayIndustries = actionObj.industries; let arrayMotivations = actionObj.motivations; let arrayTargetLocation = actionObj.locations.target; let region = checkField(actionObj.locations.source[0].region.name); let subRegion = checkField(actionObj.locations.source[0].sub_region.name); let country = checkField(actionObj.locations.source[0].country.name); let entitySources = `${region}, ${subRegion}, ${country}`; $(\"#threat-actor-title\").html(actionObj.name); $(\"#threat-actor-aliases\").html(checkThreatActorField(threatActorAliases)); $(\"#threat-actor-description\").html(checkField(actionObj.description)); $(\"#threat-actor-audiences\").html(checkThreatActorField(arrayAudiences)); $(\"#threat-actor-industries\").html(checkThreatActorField(arrayIndustries)); $(\"#threat-actor-motivations\").html(checkThreatActorField(arrayMotivations)); $(\"#threat-actor-source-location\").html(entitySources); $(\"#threat-actor-target-location\").html(checkThreatActorField(arrayTargetLocation)); $(\"#threat-actor-last-time\").html(checkField(actionObj.last_activity_time)); checkLink(actionObj.report_link, $(\"#threat-actor-link\")); $(\"#fields\").attr('id', `${removeSpecialSymbols(elId)}`); $(`[id=${type}]`).removeClass(\"hidden\"); } else if (type === 'vulnerability') { $(\"#vulnerability-title\").html(el.Entity); let vulnerabilityDescription = actionObj.description ? cutTag(actionObj.description) : 'n/a'; let vulnerabilityExecutiveSummary = actionObj.executive_summary ? cutTag(actionObj.executive_summary) : 'n/a'; let vulnerabilityAnalysis = actionObj.analysis ? cutTag(actionObj.analysis) : 'n/a'; let vulnerabilityFixReferences = actionObj.vendor_fix_references.length > 0 ? createUrlList(actionObj.vendor_fix_references) : 'n/a'; $(\"#vulnerability-description\").html(vulnerabilityDescription); $(\"#vulnerability-executive-summary\").html(vulnerabilityExecutiveSummary); $(\"#vulnerability-analysis\").html(vulnerabilityAnalysis); $(\"#vulnerability-fix-references\").html(vulnerabilityFixReferences); $(\"#vulnerability-risk-rating\").html(checkField(actionObj.risk_rating)); $(\"#vulnerability-exploitation-state\").html(checkField(actionObj.exploitation_state)); $(\"#vulnerability-date-disclosure\").html(checkField(actionObj.date_of_disclosure)); $(\"#vulnerability-exploitation-vectors\").html(checkField(actionObj.exploitation_vectors)); $(\"#vulnerability-exploitation-consequence\").html(checkField(actionObj.exploitation_consequence)); checkLink(actionObj.report_link, $(\"#vulnerability-exploitation-link\")); $(\"#fields\").attr('id', `${removeSpecialSymbols(elId)}`); $(`[id=${type}]`).removeClass(\"hidden\"); } else if (indicatorsType.includes(type)) { $(\"#indicators-title\").html(el.Entity); $(\"#indicators-score\").html(checkField(actionObj.mscore)); let malwareAssociations; if (actionObj.attributed_associations === undefined) { malwareAssociations = \"n/a\" } else { malwareAssociations = actionObj.attributed_associations.map((el) => el.type); malwareAssociations[0] === \"malware\" ? malwareAssociations = actionObj.attributed_associations.map((el) => el.name) : malwareAssociations = \"n/a\"; } let actorAssociations; if (actionObj.attributed_associations === undefined) { actorAssociations = \"n/a\" } else { actorAssociations = actionObj.attributed_associations.map((el) => el.type); actorAssociations[0] === \"threat-actor\" ? actorAssociations = actionObj.attributed_associations.map((el) => el.name) : actorAssociations = \"n/a\"; } $(\"#indicators-actor-associations\").html(actorAssociations); $(\"#indicators-malware-associations\").html(malwareAssociations); $(\"#indicators-first-seen\").html(checkField(actionObj.first_seen)); $(\"#indicators-last-seen\").html(checkField(actionObj.last_seen)); $(\"#fields\").attr('id', `${removeSpecialSymbols(elId)}`); checkLink(actionObj.report_link, $(\"#indicators-link\")); $('[id=\"indicators\"]').removeClass(\"hidden\"); } } let defaultEntity = actionData[0]; entityDisplayed(defaultEntity); function createUrlList(el) { let html = ''; if (typeof el != 'string') { el.forEach((item, index) => { html += `<a href=${item.url} target=\"_blank\" class=\"fieldEntityHidden\" style=\"color: #669DF6; text-decoration-line: underline; width: 100%; padding-bottom: 2px;\" id=\"${index};\">&#183; ${item.url}</a>` }) } $(\"#vulnerability-fix-references\").html(html) } function createLeftMenu() { let string = ''; actionData.forEach((el, index) => { if (Array.isArray(el.EntityResult)) { if (availableType.includes(el.EntityResult[0].type)) { index ? string += `<div class=\"leftMenu\" id=${removeSpecialSymbols(el.Entity)}>${el.Entity}</div>` : string += `<div class=\"leftMenu active\" id=${removeSpecialSymbols(el.Entity)}>${el.Entity}</div>` } } else { if (availableType.includes(el.EntityResult.type)) { index ? string += `<div class=\"leftMenu\" id=${removeSpecialSymbols(el.Entity)}>${el.Entity}</div>` : string += `<div class=\"leftMenu active\" id=${removeSpecialSymbols(el.Entity)}>${el.Entity}</div>` } } }); $(\"#leftMenu\").html(string) } createLeftMenu(); $(\".cntLeftSide\").click(function (event) { let arrayLeftSide = $(\".leftMenu\"); let id = event.target.id; let right = $(\".fields\"); $.each(right, function (key, entity) { entity.classList.add(\"hidden\") }); $.each(arrayLeftSide, function (key, entity) { if (entity.id === id) { $(`#${entity.id}`).addClass(\"active\") } else { $(`#${entity.id}`).removeClass(\"active\") } }); let object = actionData.find((el) => { if (Array.isArray(el.EntityResult)) { return removeSpecialSymbols(el.Entity) === id } else { return removeSpecialSymbols(el.Entity) === id } }); entityDisplayed(object); let arrayRightSide = $(\".fieldEntityHidden\"); $.each(arrayRightSide, function (key, entity) { entity.classList.remove(\"fieldEntityOpen\") }) }); $(\".field\").click(function (event) { let id = event.target.id; let element = $(`#${id}`); if (element.hasClass(\"fieldEntityOpen\")) { element.removeClass(\"fieldEntityOpen\") } else { element.addClass(\"fieldEntityOpen\") } }); } });</script></body></html>",
    "htmlHeight": 400,
    "safeRendering": false,
    "type": 3,
    "widgetDefinitionScope": 2
  },
  "conditionsGroup": {
    "conditions": [
      {
        "value": "true",
        "fieldName": "[{stepInstanceName}.is_success]",
        "matchType": 0
      }
    ],
    "logicalOperator": 0
  },
  "defaultSize": 1
}