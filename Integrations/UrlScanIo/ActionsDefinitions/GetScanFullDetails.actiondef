{
    "CreationTimeUnixTimeInMs": 1523801165235, 
    "Creator": "admin", 
    "Description": "Get Scan Full Details by scan ID", 
    "DynamicResultsMetadata": [
        {
            "ResultExample": "[{\"data\":{\"requests\":[{\"request\":{\"requestId\":\"2E282E5F97XXXXXXXXAA74A14B2C42\",\"loaderId\":\"2E282E5F97XXXXXXXXAA74A14B2C42\",\"documentURL\":\"http://145.112.368.158/bins/test.org\",\"request\":{\"url\":\"http://145.112.368.158/bins/test.org\",\"method\":\"GET\",\"headers\":{\"Upgrade-Insecure-Requests\":\"1\",\"User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36\"},\"mixedContentType\":\"none\",\"initialPriority\":\"VeryHigh\",\"referrerPolicy\":\"no-referrer-when-downgrade\"},\"timestamp\":19089897.282696,\"wallTime\":1607875822.141159,\"initiator\":{\"type\":\"other\"},\"type\":\"Document\",\"frameId\":\"B51D9A02BF27XXXXXXXXBA9C296F5DD\",\"hasUserGesture\":false},\"response\":{\"encodedDataLength\":0,\"dataLength\":0,\"requestId\":\"2E282E5F97XXXXXXXXAA74A14B2C42\",\"type\":\"Document\",\"response\":{\"url\":\"http://145.112.368.158/bins/test.org\",\"status\":200,\"statusText\":\"OK\",\"headers\":{\"Date\":\"Sun, 13 Dec 2020 16:10:22 GMT\",\"Server\":\"Apache/2.2.15 (CentOS)\",\"Last-Modified\":\"Sun, 13 Dec 2020 15:17:50 GMT\",\"ETag\":\"\\\"206ea-c48c-5b65a0762b76b\\\"\",\"Accept-Ranges\":\"bytes\",\"Content-Length\":\"50316\",\"Connection\":\"close\",\"Content-Type\":\"text/plain; charset=UTF-8\"},\"mimeType\":\"application/octet-stream\",\"requestHeaders\":{\"Host\":\"145.112.368.158\",\"Connection\":\"keep-alive\",\"Pragma\":\"no-cache\",\"Cache-Control\":\"no-cache\",\"Upgrade-Insecure-Requests\":\"1\",\"User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36\",\"Accept\":\"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\",\"Accept-Encoding\":\"gzip, deflate\",\"Accept-Language\":\"en-US\"},\"remoteIPAddress\":\"145.112.368.158\",\"remotePort\":80,\"fromPrefetchCache\":false,\"encodedDataLength\":273,\"timing\":{\"requestTime\":19089897.283066,\"proxyStart\":-1,\"proxyEnd\":-1,\"dnsStart\":0.318,\"dnsEnd\":0.322,\"connectStart\":0.322,\"connectEnd\":21.482,\"sslStart\":-1,\"sslEnd\":-1,\"workerStart\":-1,\"workerReady\":-1,\"workerFetchStart\":-1,\"workerRespondWithSettled\":-1,\"sendStart\":21.535,\"sendEnd\":21.578,\"pushStart\":0,\"pushEnd\":0,\"receiveHeadersEnd\":299.269},\"responseTime\":1607875822440.743,\"protocol\":\"http/1.1\",\"securityState\":\"insecure\"},\"failed\":{\"requestId\":\"2E282E5F97XXXXXXXXAA74A14B2C42\",\"timestamp\":19089897.583037,\"type\":\"Document\",\"errorText\":\"net::ERR_ABORTED\",\"canceled\":true},\"asn\":{\"ip\":\"145.112.368.158\",\"asn\":\"47869\",\"country\":\"NL\",\"registrar\":\"ripencc\",\"date\":\"2008-09-09\",\"description\":\"NETROUTING-AS, NL\",\"route\":\"185.144.156.0/22\",\"name\":\"NETROUTING-AS\"},\"geoip\":{\"range\":[3113262080,3113263103],\"country\":\"US\",\"region\":\"FL\",\"eu\":\"0\",\"timezone\":\"America/New_York\",\"city\":\"Miami\",\"ll\":[25.7806,-80.1826],\"metro\":528,\"area\":1000,\"country_name\":\"United States\"},\"rdns\":{\"ip\":\"145.112.368.158\",\"ptr\":\"8.8.8.8\"}}}],\"cookies\":[],\"console\":[],\"links\":[],\"timing\":{\"beginNavigation\":\"2020-12-13T16:10:22.140Z\"},\"globals\":[]},\"stats\":{\"resourceStats\":[{\"count\":1,\"size\":0,\"encodedSize\":0,\"latency\":0,\"countries\":[\"US\"],\"ips\":[\"145.112.368.158\"],\"type\":\"Document\",\"compression\":\"NaN\",\"percentage\":null}],\"protocolStats\":[{\"count\":1,\"size\":0,\"encodedSize\":0,\"ips\":[\"145.112.368.158\"],\"countries\":[\"US\"],\"securityState\":{},\"protocol\":\"http/1.1\"}],\"tlsStats\":[{\"count\":1,\"size\":0,\"encodedSize\":0,\"ips\":[\"145.112.368.158\"],\"countries\":[\"US\"],\"protocols\":{},\"securityState\":\"insecure\"}],\"serverStats\":[{\"count\":1,\"size\":0,\"encodedSize\":0,\"ips\":[\"145.112.368.158\"],\"countries\":[\"US\"],\"server\":\"Apache/2.2.15 (CentOS)\"}],\"domainStats\":[{\"count\":1,\"ips\":[\"145.112.368.158\"],\"domain\":\"145.112.368.158\",\"size\":0,\"encodedSize\":0,\"countries\":[\"US\"],\"index\":0,\"initiators\":[],\"redirects\":0}],\"regDomainStats\":[{\"count\":1,\"ips\":[\"145.112.368.158\"],\"regDomain\":\"158.181\",\"size\":0,\"encodedSize\":0,\"countries\":[],\"index\":0,\"subDomains\":[],\"redirects\":0}],\"secureRequests\":0,\"securePercentage\":0,\"IPv6Percentage\":0,\"uniqCountries\":1,\"totalLinks\":0,\"malicious\":0,\"adBlocked\":0,\"ipStats\":[{\"requests\":1,\"domains\":[\"145.112.368.158\"],\"ip\":\"145.112.368.158\",\"asn\":{\"ip\":\"145.112.368.158\",\"asn\":\"47869\",\"country\":\"NL\",\"registrar\":\"ripencc\",\"date\":\"2008-09-09\",\"description\":\"NETROUTING-AS, NL\",\"route\":\"185.144.156.0/22\",\"name\":\"NETROUTING-AS\"},\"dns\":{},\"geoip\":{\"range\":[3113262080,3113263103],\"country\":\"US\",\"region\":\"FL\",\"eu\":\"0\",\"timezone\":\"America/New_York\",\"city\":\"Miami\",\"ll\":[25.7806,-80.1826],\"metro\":528,\"area\":1000,\"country_name\":\"United States\"},\"size\":0,\"encodedSize\":0,\"countries\":[\"US\"],\"index\":0,\"ipv6\":false,\"redirects\":0,\"count\":null,\"rdns\":{\"ip\":\"145.112.368.158\",\"ptr\":\"8.8.8.8\"}}]},\"meta\":{\"processors\":{\"wappa\":{\"state\":\"done\",\"data\":[{\"app\":\"CentOS\",\"confidence\":[{\"pattern\":\"headers server /CentOS/i\",\"confidence\":100}],\"confidenceTotal\":100,\"icon\":\"CentOS.png\",\"website\":\"http://centos.org\",\"categories\":[{\"name\":\"Operating Systems\",\"priority\":6}]},{\"app\":\"Apache\",\"confidence\":[{\"pattern\":\"headers server /(?:Apache(?:$|\\\\\\\\/([\\\\\\\\d.]+)|[^/-])|(?:^|\\\\\\\\b)HTTPD)/i\",\"confidence\":100}],\"confidenceTotal\":100,\"version\":\"2.2.15\",\"icon\":\"Apache.svg\",\"website\":\"http://apache.org\",\"categories\":[{\"name\":\"Web Servers\",\"priority\":8}]}]},\"geoip\":{\"state\":\"done\",\"data\":[{\"ip\":\"145.112.368.158\",\"geoip\":{\"range\":[3113262080,3113263103],\"country\":\"US\",\"region\":\"FL\",\"eu\":\"0\",\"timezone\":\"America/New_York\",\"city\":\"Miami\",\"ll\":[25.7806,-80.1826],\"metro\":528,\"area\":1000,\"country_name\":\"United States\"}}]},\"asn\":{\"state\":\"done\",\"data\":[{\"ip\":\"145.112.368.158\",\"asn\":\"47869\",\"country\":\"NL\",\"registrar\":\"ripencc\",\"date\":\"2008-09-09\",\"description\":\"NETROUTING-AS, NL\",\"route\":\"185.144.156.0/22\",\"name\":\"NETROUTING-AS\"}]},\"rdns\":{\"state\":\"done\",\"data\":[{\"ip\":\"145.112.368.158\",\"ptr\":\"8.8.8.8\"}]},\"done\":{\"state\":\"done\",\"data\":{\"state\":\"done\"}}}},\"task\":{\"uuid\":\"63e1af70-7412XXXXXXX34-9970e1149949\",\"time\":\"2020-12-13T16:10:22.013Z\",\"url\":\"http://145.112.368.158/bins/test.org\",\"visibility\":\"public\",\"options\":{\"useragent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36\"},\"method\":\"automatic\",\"source\":\"urlhaus\",\"tags\":[],\"userAgent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36\",\"reportURL\":\"https://urlscan.io/result/63e1af70-7412XXXXXXX34-9970e1149949/\",\"screenshotURL\":\"https://urlscan.io/screenshots/63e1af70-7412XXXXXXX34-9970e1149949.png\",\"domURL\":\"https://urlscan.io/dom/63e1af70-7412XXXXXXX34-9970e1149949/\"},\"page\":{\"url\":\"http://145.112.368.158/bins/test.org\",\"domain\":\"145.112.368.158\",\"country\":\"US\",\"city\":\"Miami\",\"server\":\"Apache/2.2.15 (CentOS)\",\"ip\":\"145.112.368.158\",\"ptr\":\"8.8.8.8\",\"asn\":\"AS47869\",\"asnname\":\"NETROUTING-AS, NL\"},\"lists\":{\"ips\":[\"145.112.368.158\"],\"countries\":[\"US\"],\"asns\":[\"47869\"],\"domains\":[\"145.112.368.158\"],\"servers\":[\"Apache/2.2.15 (CentOS)\"],\"urls\":[\"http://145.112.368.158/bins/test.org\"],\"linkDomains\":[],\"certificates\":[],\"hashes\":[]},\"verdicts\":{\"overall\":{\"score\":0,\"categories\":[],\"brands\":[],\"tags\":[],\"malicious\":false,\"hasVerdicts\":0},\"urlscan\":{\"score\":0,\"categories\":[],\"brands\":[],\"tags\":[],\"detectionDetails\":[],\"malicious\":false},\"engines\":{\"score\":0,\"malicious\":[],\"benign\":[],\"maliciousTotal\":0,\"benignTotal\":0,\"verdicts\":[],\"enginesTotal\":0},\"community\":{\"score\":0,\"votes\":[],\"votesTotal\":0,\"votesMalicious\":0,\"votesBenign\":0,\"tags\":[],\"categories\":[]}},\"Effective URL\":\"http://145.112.368.158/bins/test.org\"}]", 
            "ResultName": "JsonResult"
        }
    ], 
    "Id": -1, 
    "IntegrationIdentifier": "UrlScanIo", 
    "IsCustom": false, 
    "IsEnabled": true, 
    "ModificationTimeUnixTimeInMs": 1523801165235, 
    "Name": "Get Scan Full Details", 
    "Parameters": [
        {
            "CreationTimeUnixTimeInMs": 1523801165235, 
            "CustomActionId": -1, 
            "DefaultValue": "", 
            "Description": "Get scan report using the scan ID. Comma separated values.", 
            "Id": -1, 
            "IsMandatory": true, 
            "ModificationTimeUnixTimeInMs": 1523801165235, 
            "Name": "Scan ID", 
            "Type": 0, 
            "Value": ""
        }
    ], 
    "Script": "from SiemplifyDataModel import EntityTypes\nimport requests\nimport json\nimport base64\nfrom UrlScanManager import UrlScanManager\nfrom SiemplifyAction import SiemplifyAction\n\ndef main():\n    siemplify = SiemplifyAction()\n    \n    conf = siemplify.get_configuration('UrlScan')\n    api_key = conf.get('ApiKey')\n    url_scan_manager = UrlScanManager(api_key)\n\n    entities_to_update = []\n\n    for entity in siemplify.target_entities:\n        if entity.entity_type == EntityTypes.URL:\n\n            # Submit url for scan\n            scan_res = url_scan_manager.scan(entity.identifier.lower())\n\n            # Check if submission successful\n            if scan_res:\n                # Get scan ID for scan report\n                scan_id = scan_res['uuid']\n                # Get scan report\n                scan_report = url_scan_manager.get_scan_report(scan_id)\n\n            if scan_report:\n                entities_to_update.append(entity)\n                # Add web link to full scan result\n                siemplify.result.add_link(\"Web Report - {0}\".format(entity.identifier), scan_res['result'])\n                # Add IP/ASNs, IP Detail, (Sub)Domains, Domain Tree, Links, Certificates data.\n                siemplify.result.add_json(entity.identifier, json.dumps(scan_report['lists']))\n                # Add screenshot\n                screenshot = requests.get(scan_report['task']['screenshotURL'])\n                siemplify.result.add_attachment('Screenshot - {0}'.format(entity.identifier), 'sss.png'.format(scan_id), base64.b64encode(screenshot.content))\n\n    if entities_to_update:\n        output_massage = 'Following entities were scanned by urlscan.io. \\n{0}'.format(entities_to_update)\n        result_value = 'true'\n    else:\n        output_massage = 'No entities were scanned.'\n        result_value = 'false'\n\n    siemplify.end(output_massage, result_value)\n\nif __name__ == \"__main__\":\n    main()", 
    "ScriptResultName": "is_success", 
    "SimulationDataJson": "{\"Entities\": []}",
    "Version": 1.0
}