<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700,700i"
    rel="stylesheet">
  <link
    href='https://fonts.googleapis.com/css?family=Source Sans Pro'
    rel='stylesheet'>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <title>Query Widget</title>
  <style>
      :root {
          --dark-gray-100: hsl(0, 0%, 1000%);
          --dark-gray-200: hsl(216, 45%, 84%);
          --dark-gray-300: hsl(220, 22%, 62%);
          --dark-gray-400: hsl(221, 26%, 46%);
          --dark-gray-500: hsl(221, 30%, 33%);
          --dark-gray-600: hsl(221, 32%, 27%);
          --dark-gray-700: hsl(221, 35%, 23%);
          --dark-gray-800: hsl(221, 35%, 20%);
          --dark-gray-900: hsl(240, 25%, 12%);
          
          --color-table-even-row: hsl(226, 32%, 15%);
          --color-link: hsl(217, 89%, 76%);

          --widget-width-in-screen: 100%;
          --widget-height-in-screen: 100%;

          --widget-font-style: normal;

          --widget-text-font: 'Source Sans Pro', sans-serif;
          --widget-number-font: 'Open Sans', sans-serif;

          --font-weight-bold: 700;
          --font-weight-semibold: 600;
          --font-weight-regular: 400;

          --font-size-big: 16px;
          --font-size-medium: 14px;

          --default-line-height: 16px;

          --scrollbar-size: 12px;
      }

      html {
          height: var(--widget-height-in-screen);
          width: var(--widget-width-in-screen);
      }

      body {
          background-color: var(--dark-gray-800);

          height: var(--widget-height-in-screen);
          width: var(--widget-width-in-screen);

          padding: 0;
          margin: 0;

          overflow: hidden;
      }

      .logo {
          padding-bottom: 8px;
          padding-top: 8px;

          float: right;
      }

      .logo svg {
          height: 32px;

          vertical-align: top;
      }

      .main-counter {
          font-style: var(--widget-font-style);

          padding: 12px 4% 12px 4%;
          
          justify-content: center;
          clear: both;
      }

      .counter {
          font-weight: var(--font-weight-bold);
          font-family: var(--widget-number-font);

          color: var(--dark-gray-100);

          font-size: 64px;
          line-height: 0;

          align-items: center;
          text-align: center;
      }

      .counter-title {
          font-weight: var(--font-weight-semibold);
          font-family: var(--widget-text-font);

          color: var(--dark-gray-100);

          font-size: 20px;

          text-transform: uppercase;
          text-align: center;
      }
      
      .main-table {
          font-family: var(--widget-text-font);
          font-style: var(--widget-font-style);

          line-height: var(--default-line-height);

          color: var(--dark-gray-100);

          overflow-x: scroll;
      }

      .main-table table {
          font-size: var(--font-size-medium);

          width: 100%;

          border-collapse: collapse;
          word-break: keep-all;
      }

      .main-table th {
          font-weight: var(--font-weight-semibold);
          line-height: var(--default-line-height);

          background-color: var(--dark-gray-600);

          padding: 8px 16px;

          text-transform: uppercase;
          vertical-align: top;
          text-align: left;
          white-space: nowrap;
      }

      .main-table tr {
          font-weight: var(--font-weight-regular);
      }

      .main-table tr:nth-child(even) {
          background-color: var(--color-table-even-row);
      }

      .main-table td {
          padding: 8px 16px;

          vertical-align: top;
      }
      
  
      .widget-container {
          padding: 8px 16px 8px 10px;
          height: 100%;

          overflow: scroll;
      }

      ::-webkit-scrollbar {
          width: var(--scrollbar-size);
          height: var(--scrollbar-size);
      }

      ::-webkit-scrollbar-thumb {
          border-radius: 10px;
          border: 3px solid transparent;
          background: var(--dark-gray-400);
          background-clip: content-box;
      }

      ::-webkit-scrollbar-track {
          background-color: transparent;
      }

      ::-webkit-scrollbar-corner {
          background-color: transparent;
      }

      .link {
          color: var(--color-link);

          font-family: var(--widget-text-font);
          font-weight: var(--font-weight-regular);
          font-style: var(--widget-font-style);
          font-size: var(--font-size-medium);

          line-height: var(--default-line-height);

          text-decoration-line: underline;
          align-items: center;
      }
  </style>
</head>
  <body>
<div class="widget-container">
  <div class="logo">
<svg id="Layer_1" style="enable-background:new 0 0 32 32;" version="1.1" viewbox="0 0 32 32" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px">
      <title>
        ElasticSearch_IntegrationImage
      </title>
      <g>
        <g>
          <path d="M29.9,15.7c-0.1-0.5-0.1-0.8-0.2-1.2H16.3v4.7h8.2c-0.2,0.8-0.5,1.5-0.9,2.1c-0.4,0.6-0.8,1.2-1.3,1.6
			c-0.7,0.6-1.5,1.1-2.5,1.5c-0.9,0.4-2.1,0.5-3.4,0.5c-1.2,0-2.4-0.2-3.4-0.6s-2-1.1-2.9-1.8s-1.5-1.7-1.9-2.8
			c-0.5-1.1-0.7-2.3-0.7-3.7s0.2-2.6,0.7-3.7c0.5-1.1,1.1-2,1.9-2.9C11,8.7,11.9,8.1,13,7.6C14,7.2,15.2,7,16.4,7
			c1.5,0,2.8,0.2,3.9,0.7c1.1,0.5,2,1.2,2.9,2.1L27,6.1c-1.3-1.3-2.8-2.5-4.6-3.2s-3.7-1.2-6-1.2c-2,0-3.9,0.4-5.6,1.1
			s-3.3,1.7-4.6,3c-1.3,1.3-2.3,2.7-3.1,4.5S2,14,2,16s0.4,4,1.2,5.7c0.8,1.8,1.8,3.2,3.1,4.5c1.3,1.3,2.9,2.3,4.6,3
			c1.8,0.7,3.6,1.1,5.6,1.1c2.2,0,4.1-0.4,5.8-1.1c1.7-0.7,3.2-1.7,4.4-3c1.1-1.2,1.9-2.5,2.5-4.1s0.9-3.2,0.9-5
			C30,16.6,30,16.2,29.9,15.7z">
          </path>
        </g>
      </g>
    </svg>
</div>
  <div class="main-counter">
  <h1 class="counter" id="counter"></h1>
  <h2 class="counter-title" id="counter-title"></h2>
</div>
  <div class="main-table">
  <table id="main-table">
    <thead>
    <tr>
      <th>
        Name
      </th>
      <th>
        Description
      </th>
      <th>
        Block Inheritance
      </th>
      <th>
        Organization Path
      </th>
    </tr>
    </thead>
    <tbody id="main-table-body"></tbody>
  </table>
</div>
</div>
<script>
    $(document).ready(() => {
        if ($("body").css("background-color") === "rgb(255, 255, 255)") {
            $(".logo svg path").attr("fill", "black");
        } else {
            $(".logo svg path").attr("fill", "white");
        }
        
        const actionListData = [{stepInstanceName}.JsonResult];
        if (!actionListData.length) {
            return;
        }

        const dataCount = actionListData.length;
        if (dataCount === 1) {
            $("#counter-title").html("ORGANIZATION FOUND");
        } else {
            $("#counter-title").html("ORGANIZATIONS FOUND");
        }

        $("#counter").html(dataCount);
        const iterListData = actionListData;
        let mhtml = "";
        $.each(actionListData, (key, el) => {
            mhtml += "<tr>";

            mhtml += "<td>" +
                fieldExists(el.name)
                + "</td>";

            mhtml += "<td>" +
                fieldExists(el.description)
                + "</td>";

            mhtml += "<td>" +
                fieldExists(el.blockInheritance)
                + "</td>";

            mhtml += "<td>" +
                fieldExists(el.orgUnitPath)
                + "</td>";

            mhtml += "</tr>";
        });

        $("#main-table-body").html(mhtml);

        // Toggle off a column if all the values in it are "N/A"
        $("th").each(function (idx, _) {
            const check = Boolean(
                $("tbody tr").find("td:eq(" + idx + ")").filter(function () {
                    return ["N/A", ""].includes($.trim($(this).text())) ? 0 : 1;
                }).length
            );

            $("tr").find("td:eq(" + idx + "), th:eq(" + idx + ")").toggle(check);
        });

        function fieldExists(field) {
            return [undefined, ""].includes(field) ? "N/A" : field;
        }
        
        
    });
</script>
</body>
</html>
