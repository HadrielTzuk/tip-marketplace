{
    "CreationTimeUnixTimeInMs": 1535885542381,
    "Creator": "System",
    "Description": "Upload and scan files via VirusTotal. *Files can be uploaded from remote path (Windows share or Linux remote server).",
    "DynamicResultsMetadata": [
        {
            "ResultExample": "[{\"EntityResult\": {\"vhash\": null, \"submission_names\": [\"file_name\", \"query.php\", \"xmldumper.php\", \"676f6f676c652xxx6d.exe\", \"isys_update_xxx.php\", \"wjzniacz\", \"acesso_seguro\"], \"scan_date\": \"2020-11-20 09:40:29\", \"first_seen\": \"2010-12-04 07:53:45\", \"total\": 61, \"additional_info\": {\"email_parents\": [], \"magic\": \"ASCII text, with no line terminators\", \"sigcheck\": {}, \"compressed_parents\": [\"2441fadeafe3b3fdb63d8a3a16ce900e44a28cddbf52dc279axxxxxx\", \"8c336c2adc8018ccbb71b45e797488b80d10da410a5c79fe250xxxx\", \"8eeab24940070ad89a835838b9392402844bcdfacfdbaa4ce4axxxxx\", \"79d8158ba573310183b46beba49c3596c321a2d369d62fe1792d3756xxxx\", \"ea10afd6489aba575c3a6bf359abe225b409f5265a1ad7f432bbxxxx\"], \"exiftool\": {\"MIMEType\": \"text/plain\", \"FileType\": \"TXT\", \"WordCount\": \"1\", \"LineCount\": \"1\", \"MIMEEncoding\": \"us-ascii\", \"FileTypeExtension\": \"txt\", \"Newlines\": \"(none)\"}, \"trid\": \"Unknown!\", \"positives_delta\": 0, \"pe_resource_parents\": [\"c14c00750ccf2b4ce39ed570bd3deb66bfc7ae126c5f557796a75axxxxx\"]}, \"size\": 10, \"scan_id\": \"d4c9d9027326271a89ce51fcaf328ed673f17be33469fab8dd501e664f-xxxxx\", \"times_submitted\": 5, \"harmless_votes\": 0, \"verbose_msg\": \"Scan finished, information embedded\", \"sha256\": \"d4c9d9027326271a89ce51fcaf328ed673f17be33469ff979exxxxx\", \"type\": \"Text\", \"scans\": {\"Bkav\": {\"detected\": false, \"version\": \"1.x.x.9899\", \"result\": null, \"update\": \"20201119\"}, \"MicroWorld-eScan\": {\"detected\": false, \"version\": \"14.x.x.0\", \"result\": null, \"update\": \"20201120\"}, \"FireEye\": {\"detected\": false, \"version\": \"32.x.x.0\", \"result\": null, \"update\": \"20201120\"}, \"CAT-QuickHeal\": {\"detected\": false, \"version\": \"14.xx\", \"result\": null, \"update\": \"20201119\"}, \"McAfee\": {\"detected\": false, \"version\": \"6.x.x.653\", \"result\": null, \"update\": \"20201120\"}, \"Malwarebytes\": {\"detected\": false, \"version\": \"3.x.x.335\", \"result\": null, \"update\": \"20201120\"}, \"Zillya\": {\"detected\": false, \"version\": \"2.x.x.4227\", \"result\": null, \"update\": \"20201120\"}, \"Sangfor\": {\"detected\": false, \"version\": \"1.x\", \"result\": null, \"update\": \"20201116\"}, \"K7AntiVirus\": {\"detected\": false, \"version\": \"11.xx.35774\", \"result\": null, \"update\": \"20201120\"}, \"K7GW\": {\"detected\": false, \"version\": \"11.151.xx\", \"result\": null, \"update\": \"20201120\"}, \"Invincea\": {\"detected\": false, \"version\": \"1.x.x.0\", \"result\": null, \"update\": \"20201120\"}, \"Baidu\": {\"detected\": false, \"version\": \"1.x.x.2\", \"result\": null, \"update\": \"20190318\"}, \"Cyren\": {\"detected\": false, \"version\": \"6.x.x.2\", \"result\": null, \"update\": \"20201120\"}, \"Symantec\": {\"detected\": false, \"version\": \"1.x.x.0\", \"result\": null, \"update\": \"20201120\"}, \"TotalDefense\": {\"detected\": false, \"version\": \"37.x.x.1\", \"result\": null, \"update\": \"20201120\"}, \"TrendMicro-HouseCall\": {\"detected\": false, \"version\": \"10.x.x.1040\", \"result\": null, \"update\": \"20201120\"}, \"Avast\": {\"detected\": false, \"version\": \"20.x.x.0\", \"result\": null, \"update\": \"20201120\"}, \"ClamAV\": {\"detected\": false, \"version\": \"0.x.x.0\", \"result\": null, \"update\": \"20201119\"}, \"Kaspersky\": {\"detected\": false, \"version\": \"15.x.x.13\", \"result\": null, \"update\": \"20201120\"}, \"BitDefender\": {\"detected\": false, \"version\": \"7.x\", \"result\": null, \"update\": \"20201120\"}, \"NANO-Antivirus\": {\"detected\": false, \"version\": \"1.x.x.25233\", \"result\": null, \"update\": \"20201120\"}, \"ViRobot\": {\"detected\": false, \"version\": \"2014.x.x.0\", \"result\": null, \"update\": \"20201120\"}, \"AegisLab\": {\"detected\": false, \"version\": \"4.x\", \"result\": null, \"update\": \"20201120\"}, \"Tencent\": {\"detected\": false, \"version\": \"1.x.x.1\", \"result\": null, \"update\": \"20201120\"}, \"Ad-Aware\": {\"detected\": false, \"version\": \"3.x.x.117\", \"result\": null, \"update\": \"20201120\"}, \"Sophos\": {\"detected\": false, \"version\": \"4.x.0\", \"result\": null, \"update\": \"20201120\"}, \"Comodo\": {\"detected\": false, \"version\": \"336\", \"result\": null, \"update\": \"20201120\"}, \"F-Secure\": {\"detected\": false, \"version\": \"12.0.x.x\", \"result\": null, \"update\": \"20201120\"}, \"DrWeb\": {\"detected\": false, \"version\": \"7.x.x.9080\", \"result\": null, \"update\": \"20201120\"}, \"VIPRE\": {\"detected\": false, \"version\": \"88336\", \"result\": null, \"update\": \"20201120\"}, \"TrendMicro\": {\"detected\": false, \"version\": \"11.x.x.1006\", \"result\": null, \"update\": \"20201120\"}, \"McAfee-GW-Edition\": {\"detected\": false, \"version\": \"v2019.1.2+xx\", \"result\": null, \"update\": \"20201119\"}, \"CMC\": {\"detected\": false, \"version\": \"2.7.x.1\", \"result\": null, \"update\": \"20201119\"}, \"Emsisoft\": {\"detected\": false, \"version\": \"2018.x.x.1641\", \"result\": null, \"update\": \"20201120\"}, \"Ikarus\": {\"detected\": false, \"version\": \"0.x.x.2\", \"result\": null, \"update\": \"20201119\"}, \"Jiangmin\": {\"detected\": false, \"version\": \"16.x.x\", \"result\": null, \"update\": \"20201120\"}, \"Avira\": {\"detected\": false, \"version\": \"8.x.x.8\", \"result\": null, \"update\": \"20201120\"}, \"Antiy-AVL\": {\"detected\": false, \"version\": \"3.0.0.1\", \"result\": null, \"update\": \"20201120\"}, \"Kingsoft\": {\"detected\": false, \"version\": \"2017.9.x.x\", \"result\": null, \"update\": \"20201120\"}, \"Microsoft\": {\"detected\": false, \"version\": \"1.1.x.x\", \"result\": null, \"update\": \"20201120\"}, \"Gridinsoft\": {\"detected\": false, \"version\": \"1.0.x.x\", \"result\": null, \"update\": \"20201120\"}, \"Arcabit\": {\"detected\": false, \"version\": \"1.0.x.x\", \"result\": null, \"update\": \"20201120\"}, \"SUPERAntiSpyware\": {\"detected\": false, \"version\": \"5.6.x.x\", \"result\": null, \"update\": \"20201113\"}, \"ZoneAlarm\": {\"detected\": false, \"version\": \"1.0\", \"result\": null, \"update\": \"20201120\"}, \"GData\": {\"detected\": false, \"version\": \"A:25.xxx:xx.20945\", \"result\": null, \"update\": \"20201120\"}, \"Cynet\": {\"detected\": false, \"version\": \"4.0.0.24\", \"result\": null, \"update\": \"20201120\"}, \"AhnLab-V3\": {\"detected\": false, \"version\": \"3.19.x.xx\", \"result\": null, \"update\": \"20201120\"}, \"BitDefenderTheta\": {\"detected\": false, \"version\": \"7.2.xx.x\", \"result\": null, \"update\": \"20201113\"}, \"ALYac\": {\"detected\": false, \"version\": \"1.x.x.5\", \"result\": null, \"update\": \"20201120\"}, \"TACHYON\": {\"detected\": false, \"version\": \"2020-11-20.02\", \"result\": null, \"update\": \"20201120\"}, \"VBA32\": {\"detected\": false, \"version\": \"4.4.1\", \"result\": null, \"update\": \"20201120\"}, \"Zoner\": {\"detected\": false, \"version\": \"0.x.x.0\", \"result\": null, \"update\": \"20201119\"}, \"ESET-NOD32\": {\"detected\": false, \"version\": \"223x\", \"result\": null, \"update\": \"20201119\"}, \"Rising\": {\"detected\": false, \"version\": \"25.0.x.x\", \"result\": null, \"update\": \"20201120\"}, \"Yandex\": {\"detected\": false, \"version\": \"5.5.x.xx\", \"result\": null, \"update\": \"20201117\"}, \"MAX\": {\"detected\": false, \"version\": \"2019.9.x.x\", \"result\": null, \"update\": \"20201120\"}, \"MaxSecure\": {\"detected\": false, \"version\": \"1.0.x.x\", \"result\": null, \"update\": \"20201119\"}, \"Fortinet\": {\"detected\": false, \"version\": \"6.2.x.x\", \"result\": null, \"update\": \"20201120\"}, \"AVG\": {\"detected\": false, \"version\": \"20.10.xx.x\", \"result\": null, \"update\": \"20201120\"}, \"Panda\": {\"detected\": false, \"version\": \"4.6.x.x\", \"result\": null, \"update\": \"20201119\"}, \"Qihoo-360\": {\"detected\": false, \"version\": \"1.0.x.xx\", \"result\": null, \"update\": \"20201120\"}}, \"tags\": [\"text\"], \"authentihash\": null, \"unique_sources\": 4, \"positives\": 0, \"ssdeep\": \"3:duK:IK\", \"md5\": \"1d5920f4b44b27a802bd77c4f053xxxx\", \"permalink\": \"https://www.virustotal.com/gui/file/d4c9d9027326271a89ce51fcaf328ed673f17be33469ff979e8abxxxx/detection/f-d4c9d9027326271a89ce51f8ed673f17be33469ff979e8ab8dd501e664f-xxxx\", \"sha1\": \"baea954b95731c68ae6e45bd1e252eb4xxxx\", \"resource\": \"d4c9d9027326271a89ce51f8ed673f17be33469ff979e8ab8dd501e664f-xxxxx\", \"response_code\": 1, \"community_reputation\": 0, \"malicious_votes\": 0, \"ITW_urls\": [\"http://52.xx.xx.234/tranquilapi/routes/query.php\", \"http://130.xx.81.xx/seeddms/pear/query.php\", \"http://110.5.xx.xx/conf/xmldumper.php\", \"http://bb.lucidweb.space/\", \"http://195.201.xx.xx/updates/classes/isys_update_sync.php?forumID=26120176&method=up\", \"http://195.xx.xx.26/updates/classes/isys_update_sync.php\"], \"last_seen\": \"2020-11-20 09:40:29\"}, \"Entity\": \"/opt/siemplify/siemplify_xxxx/Logs/file_name.txt\"}]",
            "ResultName": "JsonResult"
        }
    ],
    "Id": -1,
    "IntegrationIdentifier": "VirusTotal",
    "IsCustom": false,
    "IsEnabled": true,
    "ModificationTimeUnixTimeInMs": 1535885542381,
    "Name": "Upload And Scan Files",
    "Parameters": [
        {
            "CreationTimeUnixTimeInMs": 1535885542381,
            "CustomActionId": -1,
            "DefaultValue": "",
            "Description": "Entity risk threshold.",
            "Id": -1,
            "IsMandatory": true,
            "ModificationTimeUnixTimeInMs": 1535885542381,
            "Name": "Threshold",
            "Type": 0,
            "Value": ""
        },
        {
            "CreationTimeUnixTimeInMs": 1535885542381,
            "CustomActionId": -1,
            "DefaultValue": "",
            "Description": "Target file path.",
            "Id": -1,
            "IsMandatory": true,
            "ModificationTimeUnixTimeInMs": 1535885542381,
            "Name": "File Paths",
            "Type": 0,
            "Value": ""
        },
        {
            "CreationTimeUnixTimeInMs": 1535885542381,
            "CustomActionId": -1,
            "DefaultValue": "",
            "Description": "Linux server address(e.g: x.x.x.x).",
            "Id": -1,
            "IsMandatory": false,
            "ModificationTimeUnixTimeInMs": 1535885542381,
            "Name": "Linux Server Address",
            "Type": 0,
            "Value": ""
        },
        {
            "CreationTimeUnixTimeInMs": 1535885542381,
            "CustomActionId": -1,
            "DefaultValue": "",
            "Description": "",
            "Id": -1,
            "IsMandatory": false,
            "ModificationTimeUnixTimeInMs": 1535885542381,
            "Name": "Linux User",
            "Type": 0,
            "Value": ""
        },
        {
            "CreationTimeUnixTimeInMs": 1535885542381,
            "CustomActionId": -1,
            "DefaultValue": "",
            "Description": "",
            "Id": -1,
            "IsMandatory": false,
            "ModificationTimeUnixTimeInMs": 1535885542381,
            "Name": "Linux Password",
            "Type": 12,
            "Value": ""
        }
    ],
    "Script": "from VTFileOperationManager import FileOperationManager\nfrom VirusTotal import VirusTotalManager\nfrom SiemplifyAction import SiemplifyAction\nfrom ScriptResult import EXECUTION_STATE_COMPLETED, EXECUTION_STATE_INPROGRESS\nimport sys\n\n\ndef main():\n    siemplify = SiemplifyAction()\n    siemplify.script_name = 'VirusTotal - upload file'\n\n    conf = siemplify.get_configuration('VirusTotal')\n    api_key = conf['Api Key']\n    use_ssl = conf['Use SSL'].lower() == 'true'\n    vt = VirusTotalManager(api_key, use_ssl)\n\n    file_manager = FileOperationManager()\n    file_path = siemplify.parameters['File Path']\n    linux_server_address = siemplify.parameters.get('Linux Server Address')\n\n    # In case file is in remote linux send box\n    if linux_server_address:\n        linux_user = siemplify.parameters.get('Linux User')\n        linux_password = siemplify.parameters.get('Linux Password')\n\n        file_byte_array = file_manager.get_remote_unix_file_content(linux_server_address,\n                                                                    linux_user,\n                                                                    linux_password,\n                                                                    file_path)\n        scan_id = vt.upload_file(file_path, file_byte_array)\n\n    # If the path is accessible the manager will fetch the file binary content by itself\n    else:\n        scan_id = vt.upload_file(file_path)\n\n    output_massage = \"File submitted successfully.\"\n    siemplify.LOGGER.info(\"File {0} submitted successfully.\".format(file_path))\n\n    siemplify.end(output_massage, scan_id, EXECUTION_STATE_INPROGRESS)\n\n\ndef fetch_scan_report_async():\n\n    siemplify = SiemplifyAction()\n    siemplify.script_name = 'VirusTotal - upload file'\n\n    conf = siemplify.get_configuration('VirusTotal')\n    api_key = conf['Api Key']\n    use_ssl = conf['Use SSL'].lower() == 'true'\n    vt = VirusTotalManager(api_key, use_ssl)\n\n    file_path = siemplify.parameters['File Path']\n    threshold = siemplify.parameters.get('Threshold', 3)\n\n    search_data = {}\n    result_value = False\n    # Extract scan id\n    scan_id = siemplify.parameters[\"additional_data\"]\n\n    try:\n        if scan_id:\n            report = vt.get_report_by_scan_id(scan_id)\n\n            if report:\n                siemplify.LOGGER.info(\"File {0} is ready.\".format(file_path))\n                # Scan detections_information\n                search_data['VT_risk_score'] = report['positives']\n                search_data['VT_total_score'] = report['total']\n                data_table = vt.build_engine_csv(report['scans'])\n                siemplify.result.add_entity_table('{0} Report'.format(file_path), data_table)\n\n                web_link = report['permalink']\n                siemplify.result.add_link('Virus Total Web Link', web_link)\n                # Check for risk\n                if int(threshold) < search_data['VT_risk_score']:\n                    result_value = True\n                output_massage = \"VirusTotal - {0} marked as malicious by {1} of {2} engines - Threshold set to - {3} (if exceed threshold)\".format(file_path,\n                                                                                                search_data['VT_risk_score'],\n                                                                                                search_data['VT_total_score'],\n                                                                                                threshold)\n                siemplify.end(output_massage, result_value, EXECUTION_STATE_COMPLETED)\n            else:\n                siemplify.LOGGER.info(\"File {0} is still queued for analysis.\".format(file_path))\n                output_massage = \"Continuing...the requested item is still queued for analysis {0}\".format(file_path)\n                siemplify.end(output_massage, scan_id, EXECUTION_STATE_INPROGRESS)\n    except Exception as e:\n        siemplify.LOGGER._log.exception(e)\n        raise\n\n\nif __name__ == \"__main__\":\n    if len(sys.argv) < 3 or sys.argv[2] == 'True':\n        main()\n    else:\n        fetch_scan_report_async()\n",
    "ScriptResultName": "is_risky",
    "Version": 2.0,
    "SimulationDataJson": "{\"Entities\":[]}",
    "IsAsync": true
}